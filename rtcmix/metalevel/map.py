"""
Utility functions for converting between note names and MIDI key numbers.
"""

def nameToNum(name):
  """Function to convert a note name into a MIDI key number. This probably
  isn't a terribly efficient way to do it, but it was fun to write. Enjoy."""
  split = -1
  #print "trying for name: " + name
  for i in range(len(name)):
    fail = False
    try:
      int(name[i:])
    except:
      #print name[i:] + " wasn't an int"
      fail = True
    if (not fail):
      split = i
      break
  
  octave = -1
  strippedname = name
  if (split == -1):
    1 #nop
    #never found an int at the tail of the string
    #assume this was a raw note (no octave designation)
    #treat it as a pitch class
  else:
    #actually parse it out
    octave = int(name[i:])
    strippedname = name[0:split]
  
  #print "strippedname: " + strippedname + " octave: " + str(octave)
  pitchclass = {
  'b#':0,
  'c':0,
  'dbb':0,

  'b##':1,
  'c#':1,
  'db':1,

  'c##':2,
  'd':2,
  'ebb':2,  

  'd#':3,
  'eb':3,
  
  'd##':4,
  'e':4,
  'fb':4,

  'e#':5,
  'f':5,
  'gbb':5,

  'e##':6,
  'f#':6,
  'gb':6,

  'f##':7,
  'g':7,
  'abb':7,

  'g#':8,
  'ab':8,

  'g##':9,
  'a':9,
  'bbb':9,

  'a#':10,
  'bb':10,
  'cbb':10,
  
  'a##':11,
  'b':11,
  'cb':11
  }.get(strippedname.lower(), None)

  if (pitchclass == None):
    raise Exception('Something terrible has happened.')
  
  #print "pitchclass: " + str(pitchclass)
  return (octave+1)*12 + pitchclass

def numToName(num):
  """Function for converting MIDI key number to note name."""
  pitchclass = num%12
  octave = num/12 - 1
  name = {
  0:'C',
  1:'C#',
  2:'D',
  3:'D#',
  4:'E',
  5:'F',
  6:'F#',
  7:'G',
  8:'G#',
  9:'A',
  10:'A#',
  11:'B'
  }.get(pitchclass, None)
  
  if (num == None):
    raise Exception('Something terrible has happened.')
  return str(name) + str(octave)

def nameToNumRaw(name):
  """raw mapping of note names to MIDI key numbers. Here as an example.
  See nameToNum(name) for a more general implementation."""
  return {
  'C-1':0,
  'C-1'.lower():0,
  'C#-1':1,
  'C#-1'.lower():1,
  'D-1':2,
  'D-1'.lower():2,
  'D#-1':3,
  'D#-1'.lower():3,
  'E-1':4,
  'E-1'.lower():4,
  'F-1':5,
  'F-1'.lower():5,
  'F#-1':6,
  'F#-1'.lower():6,
  'G-1':7,
  'G-1'.lower():7,
  'G#-1':8,
  'G#-1'.lower():8,
  'A-1':9,
  'A-1'.lower():9,
  'A#-1':10,
  'A#-1'.lower():10,
  'B-1':11,
  'B-1'.lower():11,
  'C0':12,
  'C0'.lower():12,
  'C#0':13,
  'C#0'.lower():13,
  'D0':14,
  'D0'.lower():14,
  'D#0':15,
  'D#0'.lower():15,
  'E0':16,
  'E0'.lower():16,
  'F0':17,
  'F0'.lower():17,
  'F#0':18,
  'F#0'.lower():18,
  'G0':19,
  'G0'.lower():19,
  'G#0':20,
  'G#0'.lower():20,
  'A0':21,
  'A0'.lower():21,
  'A#0':22,
  'A#0'.lower():22,
  'B0':23,
  'B0'.lower():23,
  'C1':24,
  'C1'.lower():24,
  'C#1':25,
  'C#1'.lower():25,
  'D1':26,
  'D1'.lower():26,
  'D#1':27,
  'D#1'.lower():27,
  'E1':28,
  'E1'.lower():28,
  'F1':29,
  'F1'.lower():29,
  'F#1':30,
  'F#1'.lower():30,
  'G1':31,
  'G1'.lower():31,
  'G#1':32,
  'G#1'.lower():32,
  'A1':33,
  'A1'.lower():33,
  'A#1':34,
  'A#1'.lower():34,
  'B1':35,
  'B1'.lower():35,
  'C2':36,
  'C2'.lower():36,
  'C#2':37,
  'C#2'.lower():37,
  'D2':38,
  'D2'.lower():38,
  'D#2':39,
  'D#2'.lower():39,
  'E2':40,
  'E2'.lower():40,
  'F2':41,
  'F2'.lower():41,
  'F#2':42,
  'F#2'.lower():42,
  'G2':43,
  'G2'.lower():43,
  'G#2':44,
  'G#2'.lower():44,
  'A2':45,
  'A2'.lower():45,
  'A#2':46,
  'A#2'.lower():46,
  'B2':47,
  'B2'.lower():47,
  'C3':48,
  'C3'.lower():48,
  'C#3':49,
  'C#3'.lower():49,
  'D3':50,
  'D3'.lower():50,
  'D#3':51,
  'D#3'.lower():51,
  'E3':52,
  'E3'.lower():52,
  'F3':53,
  'F3'.lower():53,
  'F#3':54,
  'F#3'.lower():54,
  'G3':55,
  'G3'.lower():55,
  'G#3':56,
  'G#3'.lower():56,
  'A3':57,
  'A3'.lower():57,
  'A#3':58,
  'A#3'.lower():58,
  'B3':59,
  'B3'.lower():59,
  'C4':60,
  'C4'.lower():60,
  'C#4':61,
  'C#4'.lower():61,
  'D4':62,
  'D4'.lower():62,
  'D#4':63,
  'D#4'.lower():63,
  'E4':64,
  'E4'.lower():64,
  'F4':65,
  'F4'.lower():65,
  'F#4':66,
  'F#4'.lower():66,
  'G4':67,
  'G4'.lower():67,
  'G#4':68,
  'G#4'.lower():68,
  'A4':69,
  'A4'.lower():69,
  'A#4':70,
  'A#4'.lower():70,
  'B4':71,
  'B4'.lower():71,
  'C5':72,
  'C5'.lower():72,
  'C#5':73,
  'C#5'.lower():73,
  'D5':74,
  'D5'.lower():74,
  'D#5':75,
  'D#5'.lower():75,
  'E5':76,
  'E5'.lower():76,
  'F5':77,
  'F5'.lower():77,
  'F#5':78,
  'F#5'.lower():78,
  'G5':79,
  'G5'.lower():79,
  'G#5':80,
  'G#5'.lower():80,
  'A5':81,
  'A5'.lower():81,
  'A#5':82,
  'A#5'.lower():82,
  'B5':83,
  'B5'.lower():83,
  'C6':84,
  'C6'.lower():84,
  'C#6':85,
  'C#6'.lower():85,
  'D6':86,
  'D6'.lower():86,
  'D#6':87,
  'D#6'.lower():87,
  'E6':88,
  'E6'.lower():88,
  'F6':89,
  'F6'.lower():89,
  'F#6':90,
  'F#6'.lower():90,
  'G6':91,
  'G6'.lower():91,
  'G#6':92,
  'G#6'.lower():92,
  'A6':93,
  'A6'.lower():93,
  'A#6':94,
  'A#6'.lower():94,
  'B6':95,
  'B6'.lower():95,
  'C6':96,
  'C6'.lower():96,
  'C#7':97,
  'C#7'.lower():97,
  'D7':98,
  'D7'.lower():98,
  'D#7':99,
  'D#7'.lower():99,
  'E7':100,
  'E7'.lower():100,
  'F7':101,
  'F7'.lower():101,
  'F#7':102,
  'F#7'.lower():102,
  'G7':103,
  'G7'.lower():103,
  'G#7':104,
  'G#7'.lower():104,
  'A7':105,
  'A7'.lower():105,
  'A#7':106,
  'A#7'.lower():106,
  'B7':107,
  'B7'.lower():107,
  'C8':108,
  'C8'.lower():108,
  'C#8':109,
  'C#8'.lower():109,
  'D8':110,
  'D8'.lower():110,
  'D#8':111,
  'D#8'.lower():111,
  'E8':112,
  'E8'.lower():112,
  'F8':113,
  'F8'.lower():113,
  'F#8':114,
  'F#8'.lower():114,
  'G8':115,
  'G8'.lower():115,
  'G#8':116,
  'G#8'.lower():116,
  'A8':117,
  'A8'.lower():117,
  'A#8':118,
  'A#8'.lower():118,
  'B8':119,
  'B8'.lower():119,
  'C9':120,
  'C9'.lower():120,
  'C#9':121,
  'C#9'.lower():121,
  'D9':122,
  'D9'.lower():122,
  'D#9':123,
  'D#9'.lower():123,
  'E9':124,
  'E9'.lower():124,
  'F9':125,
  'F9'.lower():125,
  'F#9':126,
  'F#9'.lower():126,
  'G9':127,
  'G9'.lower():127
  }.get(name, -1)

def numToNameRaw(num):
  """Raw mapping of MIDI key numbers to note names. Here as an example. See
  numToName(num) for a more general implementation."""
  return {
  0:'C-1',
  1:'C#-1',
  2:'D-1',
  3:'D#-1',
  4:'E-1',
  5:'F-1',
  6:'F#-1',
  7:'G-1',
  8:'G#-1',
  9:'A-1',
  10:'A#-1',
  11:'B-1',
  12:'C0',
  13:'C#0',
  14:'D0',
  15:'D#0',
  16:'E0',
  17:'F0',
  18:'F#0',
  19:'G0',
  20:'G#0',
  21:'A0',
  22:'A#0',
  23:'B0',
  24:'C1',
  25:'C#1',
  26:'D1',
  27:'D#1',
  28:'E1',
  29:'F1',
  30:'F#1',
  31:'G1',
  32:'G#1',
  33:'A1',
  34:'A#1',
  35:'B1',
  36:'C2',
  37:'C#2',
  38:'D2',
  39:'D#2',
  40:'E2',
  41:'F2',
  42:'F#2',
  43:'G2',
  44:'G#2',
  45:'A2',
  46:'A#2',
  47:'B2',
  48:'C3',
  49:'C#3',
  50:'D3',
  51:'D#3',
  52:'E3',
  53:'F3',
  54:'F#3',
  55:'G3',
  56:'G#3',
  57:'A3',
  58:'A#3',
  59:'B3',
  60:'C4',
  61:'C#4',
  62:'D4',
  63:'D#4',
  64:'E4',
  65:'F4',
  66:'F#4',
  67:'G4',
  68:'G#4',
  69:'A4',
  70:'A#4',
  71:'B4',
  72:'C5',
  73:'C#5',
  74:'D5',
  75:'D#5',
  76:'E5',
  77:'F5',
  78:'F#5',
  79:'G5',
  80:'G#5',
  81:'A5',
  82:'A#5',
  83:'B5',
  84:'C6',
  85:'C#6',
  86:'D6',
  87:'D#6',
  88:'E6',
  89:'F6',
  90:'F#6',
  91:'G6',
  92:'G#6',
  93:'A6',
  94:'A#6',
  95:'B6',
  96:'C6',
  97:'C#7',
  98:'D7',
  99:'D#7',
  100:'E7',
  101:'F7',
  102:'F#7',
  103:'G7',
  104:'G#7',
  105:'A7',
  106:'A#7',
  107:'B7',
  108:'C8',
  109:'C#8',
  110:'D8',
  111:'D#8',
  112:'E8',
  113:'F8',
  114:'F#8',
  115:'G8',
  116:'G#8',
  117:'A8',
  118:'A#8',
  119:'B8',
  120:'C9',
  121:'C#9',
  122:'D9',
  123:'D#9',
  124:'E9',
  125:'F9',
  126:'F#9',
  127:'G9'
  }.get(num, None)

